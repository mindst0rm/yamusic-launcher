# YaMusic Launcher

[![Release](https://img.shields.io/github/v/release/mindst0rm/yamusic-launcher?display_name=tag)](https://github.com/mindst0rm/yamusic-launcher/releases)
[![Windows](https://img.shields.io/badge/platform-Windows%20x64-0078D6)](https://github.com/mindst0rm/yamusic-launcher)
[![.NET](https://img.shields.io/badge/.NET-8.0-512BD4)](https://dotnet.microsoft.com/)
[![Build](https://img.shields.io/badge/build-Release%20v1.1.5-success)](https://github.com/mindst0rm/yamusic-launcher/releases/tag/v1.1.5)
[![Packages](https://img.shields.io/badge/Packages-GitHub%20Packages-181717?logo=github)](https://github.com/mindst0rm?tab=packages)

–ö–æ–Ω—Å–æ–ª—å–Ω—ã–π –ª–∞—É–Ω—á–µ—Ä –¥–ª—è Windows, –∫–æ—Ç–æ—Ä—ã–π –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä—É–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∫—É –∏ –∑–∞–ø—É—Å–∫ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞ –Ø–Ω–¥–µ–∫—Å –ú—É–∑—ã–∫–∏.

## üöÄ –ß—Ç–æ –¥–µ–ª–∞–µ—Ç –ª–∞—É–Ω—á–µ—Ä

Pipeline –∑–∞–ø—É—Å–∫–∞ –∏ –ø–µ—Ä–≤–∏—á–Ω–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏:
1. –°–∫–∞—á–∏–≤–∞–µ—Ç –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∫–ª–∏–µ–Ω—Ç –Ø.–ú—É–∑—ã–∫–∏.
2. –°–∫–∞—á–∏–≤–∞–µ—Ç –º–æ–¥ (`app.asar`) –∏–∑ GitHub Releases.
3. –ü—Ä–∏–º–µ–Ω—è–µ—Ç –ø–∞—Ç—á —á–µ—Ä–µ–∑ `AsarFusePatcher.dll`.
4. –°–æ–∑–¥–∞–µ—Ç —è—Ä–ª—ã–∫–∏ –Ω–∞ –º—É–∑—ã–∫—É –∏ –Ω–∞ —Å–∞–º –ª–∞—É–Ω—á–µ—Ä.

–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ —á–µ—Ä–µ–∑ —è—Ä–ª—ã–∫ `Yandex Music Mod` –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è bootstrap-–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å:
- –ø—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç—É–∞–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–∏ –º–æ–¥–∞ –Ω–∞ GitHub;
- –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ);
- –ø–∞—Ç—á–∏–Ω–≥;
- –∑–∞–ø—É—Å–∫ –∫–ª–∏–µ–Ω—Ç–∞;
- –≤—ã–≤–æ–¥ —à–∞–ø–∫–∏ –∏ –ª–æ–≥–∞ –¥–µ–π—Å—Ç–≤–∏–π –≤ –∫–æ–Ω—Å–æ–ª–∏.

## ‚ú® –ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- –ü–µ—Ä–≤–∏—á–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤ –æ–¥–∏–Ω —Å—Ü–µ–Ω–∞—Ä–∏–π (`1/4 -> 4/4`).
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–∞—Ç–∞–ª–æ–≥–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∫–ª–∏–µ–Ω—Ç–∞.
- –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–æ–¥–∞ –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º.
- –ë—ç–∫–∞–ø—ã `app.asar` —Å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ–º –∏ —Ä—É—á–Ω–æ–π –æ—á–∏—Å—Ç–∫–æ–π.
- –ê–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞ –±—ç–∫–∞–ø–æ–≤ –ø–æ –ª–∏–º–∏—Ç—É —Ä–∞–∑–º–µ—Ä–∞ (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `300 MB`).
- –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –º–µ–Ω—é –Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏: –æ—Å–Ω–æ–≤–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è, —É—Å—Ç–∞–Ω–æ–≤–∫–∞/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ, —É—Ç–∏–ª–∏—Ç—ã, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏.
- –°–æ–∑–¥–∞–Ω–∏–µ —è—Ä–ª—ã–∫–æ–≤:
  - `Yandex Music Mod.lnk` - –∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ bootstrap;
  - `YaMusic Launcher.lnk` - –∑–∞–ø—É—Å–∫ –≥–ª–∞–≤–Ω–æ–≥–æ –º–µ–Ω—é.

## ‚ö° –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

1. –û—Ç–∫—Ä–æ–π `Releases`:  
   `https://github.com/mindst0rm/yamusic-launcher/releases`
2. –°–∫–∞—á–∞–π `YaMusicLauncher-Setup-<version>.exe` (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è).
3. –£—Å—Ç–∞–Ω–æ–≤–∏ –ª–∞—É–Ω—á–µ—Ä.
4. –ó–∞–ø—É—Å—Ç–∏ `YaMusic Launcher` –∏ –≤—ã–±–µ—Ä–∏ `–ü–µ—Ä–≤–∏—á–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞`.

## üß© –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫ –≥–æ—Ç–æ–≤–æ–≥–æ EXE

### ‚úÖ –í–∞—Ä–∏–∞–Ω—Ç 1 (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è): —á–µ—Ä–µ–∑ —É—Å—Ç–∞–Ω–æ–≤—â–∏–∫ Inno Setup

1. –°–∫–∞—á–∞–π –∏–∑ `Releases` —Ñ–∞–π–ª `YaMusicLauncher-Setup-<version>.exe`.
2. –ó–∞–ø—É—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤—â–∏–∫ –∏ —Å–ª–µ–¥—É–π —à–∞–≥–∞–º –º–∞—Å—Ç–µ—Ä–∞.
3. –ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–π —è—Ä–ª—ã–∫–∏:
   - `YaMusic Launcher` - –æ—Ç–∫—Ä—ã—Ç—å –º–µ–Ω—é –ª–∞—É–Ω—á–µ—Ä–∞;
   - `Yandex Music Mod` - –∑–∞–ø—É—Å–∫ –∫–ª–∏–µ–Ω—Ç–∞ —á–µ—Ä–µ–∑ bootstrap (–ø—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è -> –ø–∞—Ç—á–∏–Ω–≥ -> –∑–∞–ø—É—Å–∫).
4. –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –∏–∑ –º–µ–Ω—é –≤—ã–ø–æ–ª–Ω–∏ `–ü–µ—Ä–≤–∏—á–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞`.

### üì¶ –í–∞—Ä–∏–∞–Ω—Ç 2: portable EXE (–±–µ–∑ —É—Å—Ç–∞–Ω–æ–≤–∫–∏)

1. –í–æ–∑—å–º–∏ `YaLauncher.exe` –∏–∑ publish-–∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤ (`artifacts/publish/win-x64`) –∏–ª–∏ —Å–æ–±–µ—Ä–∏ –ø—Ä–æ–µ–∫—Ç –ø–æ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –Ω–∏–∂–µ.
2. –£–±–µ–¥–∏—Å—å, —á—Ç–æ —Ä—è–¥–æ–º –Ω–∞—Ö–æ–¥—è—Ç—Å—è –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ñ–∞–π–ª—ã:
   - `AsarFusePatcher.dll`
   - –ø–∞–ø–∫–∞ `7zip/`
3. –ó–∞–ø—É—Å—Ç–∏ `YaLauncher.exe`.
4. –í –º–µ–Ω—é –≤—ã–±–µ—Ä–∏ –∫–∞—Ç–∞–ª–æ–≥ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∫–ª–∏–µ–Ω—Ç–∞ –∏ –≤—ã–ø–æ–ª–Ω–∏ `–ü–µ—Ä–≤–∏—á–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞`.

### üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏ –ª–∞—É–Ω—á–µ—Ä–∞

1. –°–∫–∞—á–∞–π –Ω–æ–≤—ã–π `Setup` –∏–∑ `Releases`.
2. –£—Å—Ç–∞–Ω–æ–≤–∏ –ø–æ–≤–µ—Ä—Ö —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏.
3. –ö–æ–Ω—Ñ–∏–≥ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `%AppData%\YaMusicLauncher\config.json`.

## üì¶ Packages –∏ –¥–∏—Å—Ç—Ä–∏–±—É—Ü–∏—è

- –û—Å–Ω–æ–≤–Ω–æ–π –∫–∞–Ω–∞–ª —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è: `GitHub Releases` (–≥–æ—Ç–æ–≤—ã–π Inno Setup installer).
- –§–∞–π–ª —Ä–µ–ª–∏–∑–∞: `YaMusicLauncher-Setup-<version>.exe`.
- –ê–∫—Ç—É–∞–ª—å–Ω—ã–π —Ä–µ–ª–∏–∑: `v1.1.5`.
- –†–∞–∑–¥–µ–ª `Packages` –≤ GitHub –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—É–±–ª–∏–∫–∞—Ü–∏–µ–π NuGet-–ø–∞–∫–µ—Ç–∞ `YaMusicLauncher.Distribution` —á–µ—Ä–µ–∑ workflow.
- –ò—Å—Ç–æ—á–Ω–∏–∫ –ø–∞–∫–µ—Ç–æ–≤: `https://nuget.pkg.github.com/mindst0rm/index.json`.
- –ü–∞–∫–µ—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –≥–æ—Ç–æ–≤—ã–π publish-–≤—ã–≤–æ–¥ –ª–∞—É–Ω—á–µ—Ä–∞ (`tools/win-x64`), –≤–∫–ª—é—á–∞—è `YaLauncher.exe`, `AsarFusePatcher.dll` –∏ `7zip`.

–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ GitHub Packages feed (–µ—Å–ª–∏ –Ω—É–∂–µ–Ω –¥–æ—Å—Ç—É–ø –∫ –ø–∞–∫–µ—Ç—É –ª–æ–∫–∞–ª—å–Ω–æ):

```powershell
dotnet nuget add source "https://nuget.pkg.github.com/mindst0rm/index.json" `
  --name "github-mindst0rm" `
  --username "<github-username>" `
  --password "<github-pat-with-read:packages>" `
  --store-password-in-clear-text
```

## ü§ù Credits

- –°–ø–∞—Å–∏–±–æ [`TheKing-OfTime/YandexMusicModClient`](https://github.com/TheKing-OfTime/YandexMusicModClient) –∑–∞ –º–æ–¥-–∫–ª–∏–µ–Ω—Ç –∏ —Ä–µ–ª–∏–∑–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ `app.asar`, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –ª–∞—É–Ω—á–µ—Ä–æ–º.

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

### `YaLauncher/` (.NET 8)
- `Program.cs` - UI, bootstrap, –ø–∞–π–ø–ª–∞–π–Ω —É—Å—Ç–∞–Ω–æ–≤–∫–∏/–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è/–ø–∞—Ç—á–∏–Ω–≥–∞.
- `Storage/AppConfigStore.cs` - –∑–∞–≥—Ä—É–∑–∫–∞/—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.
- `Services/YandexMusicDownloader.cs` - –∑–∞–≥—Ä—É–∑–∫–∞ –∫–ª–∏–µ–Ω—Ç–∞.
- `Services/ModClientUpdater.cs` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–æ–¥–∞, –±—ç–∫–∞–ø—ã, changelog.
- `Services/ShortcutService.cs` - —Å–æ–∑–¥–∞–Ω–∏–µ —è—Ä–ª—ã–∫–æ–≤.
- `Services/YandexProcessManager.cs` - –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –∫–ª–∏–µ–Ω—Ç–∞.
- `Native/FuseLib.cs` - P/Invoke –¥–ª—è `AsarFusePatcher.dll`.

### `DLL_patching/` (C++/CMake)
- –ù–∞—Ç–∏–≤–Ω—ã–π –ø–∞—Ç—á–µ—Ä `AsarFusePatcher.dll`.
- –≠–∫—Å–ø–æ—Ä—Ç `DisableAsarIntegrityFuse`.

### `installer/`
- `YaMusicLauncher.iss` - Inno Setup script.

### `scripts/`
- `build-release.ps1` - release publish + —Å–±–æ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤—â–∏–∫–∞.

## üõ†Ô∏è –°–±–æ—Ä–∫–∞ –∏–∑ –∏—Å—Ö–æ–¥–Ω–∏–∫–æ–≤

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
- Windows x64
- .NET SDK 8.x
- CMake + C++ toolchain
- Inno Setup 6 (–¥–ª—è —Å–±–æ—Ä–∫–∏ –∏–Ω—Å—Ç–∞–ª–ª—è—Ç–æ—Ä–∞)

–û–±—ã—á–Ω–∞—è —Å–±–æ—Ä–∫–∞:

```powershell
dotnet build YaLauncher/YaLauncher.sln
```

–†–µ–ª–∏–∑–Ω–∞—è –ø—É–±–ª–∏–∫–∞—Ü–∏—è:

```powershell
dotnet publish YaLauncher/YaLauncher.csproj -c Release -r win-x64 --self-contained true
```

–ü–æ–ª–Ω–∞—è —Ä–µ–ª–∏–∑–Ω–∞—è —Å–±–æ—Ä–∫–∞ (publish + installer):

```powershell
powershell -ExecutionPolicy Bypass -File .\scripts\build-release.ps1 -Version 1.1.5
```

–¢–æ–ª—å–∫–æ publish (–±–µ–∑ installer):

```powershell
powershell -ExecutionPolicy Bypass -File .\scripts\build-release.ps1 -SkipInstaller
```

## üßæ –ö–æ–Ω—Ñ–∏–≥–∏, –ª–æ–≥–∏, –±—ç–∫–∞–ø—ã

- –ö–æ–Ω—Ñ–∏–≥: `%AppData%\YaMusicLauncher\config.json`
- –õ–æ–≥ –º–æ–¥–∞: `<installDir>\resources\logs\ym_mod_manager.log`
- –ë—ç–∫–∞–ø—ã: `<installDir>\resources\backups_app`

## ‚ö†Ô∏è –î–∏—Å–∫–ª–µ–π–º–µ—Ä

–ü—Ä–æ–µ–∫—Ç –Ω–µ –∞—Ñ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω —Å –Ø–Ω–¥–µ–∫—Å–æ–º. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ - –Ω–∞ –≤–∞—à —Ä–∏—Å–∫.
